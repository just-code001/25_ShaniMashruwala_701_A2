const API = '/api';
async function loadCategories(){ const res = await fetch(API+'/categories'); const cats = await res.json(); const ul = document.getElementById('cats'); ul.innerHTML=''; cats.forEach(c=>{ const li=document.createElement('li'); li.innerHTML=`<a href="#" data-id="${c._id}">${c.name}</a>`; ul.appendChild(li); if(c.children && c.children.length){ const sub=document.createElement('ul'); c.children.forEach(sc=>{ const sli=document.createElement('li'); sli.innerHTML=`<a href="#" data-id="${sc._id}">- ${sc.name}</a>`; sub.appendChild(sli); }); ul.appendChild(sub); } }); ul.addEventListener('click', async (e)=>{ if(e.target.dataset.id){ loadProducts(e.target.dataset.id); } }); }
async function loadProducts(catId){ let url=API+'/products'; if(catId) url+='?category='+catId; const res=await fetch(url); const list=await res.json(); const wrap=document.getElementById('products'); wrap.innerHTML=''; list.forEach(p=>{ const art=document.createElement('article'); art.className='card'; art.innerHTML=`<h4>${p.title}</h4><p>${p.description||''}</p><p>â‚¹${p.price}</p><button data-id="${p._id}" data-title="${p.title}" data-price="${p.price}">Add to cart</button>`; wrap.appendChild(art); }); wrap.addEventListener('click',(e)=>{ if(e.target.dataset.id){ addToCart({id:e.target.dataset.id,title:e.target.dataset.title,price: Number(e.target.dataset.price)}) } }); }
function addToCart(item){ const cart = JSON.parse(localStorage.getItem('cart')||'[]'); const found = cart.find(c=>c.id===item.id); if(found) found.qty+=1; else cart.push({...item,qty:1}); localStorage.setItem('cart',JSON.stringify(cart)); updateCartCount(); alert('Added to cart'); }
function updateCartCount(){ const count = JSON.parse(localStorage.getItem('cart')||'[]').reduce((s,i)=>s+i.qty,0); document.getElementById('cartCount').textContent = count; }
window.onload = ()=>{ loadCategories(); loadProducts(); updateCartCount(); }