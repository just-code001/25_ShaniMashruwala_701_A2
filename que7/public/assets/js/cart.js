const API = '/api';
function renderCart(){ const cart = JSON.parse(localStorage.getItem('cart')||'[]'); const wrap=document.getElementById('cartItems'); if(cart.length===0){ wrap.innerHTML='<p>No items</p>'; document.getElementById('cartTotal').textContent=''; return; } let html=''; let total=0; cart.forEach(it=>{ html+=`<div><b>${it.title}</b> x ${it.qty} - ₹${it.price*it.qty}</div>`; total+=it.price*it.qty; }); wrap.innerHTML=html; document.getElementById('cartTotal').textContent='Total: ₹'+total; }
document.getElementById('checkoutForm').addEventListener('submit', async function(e){ e.preventDefault(); const cart = JSON.parse(localStorage.getItem('cart')||'[]'); if(cart.length===0){ alert('Cart empty'); return; } const items = cart.map(c=>({ id:c.id, qty:c.qty })); const body = { customerName: document.getElementById('name').value, customerEmail: document.getElementById('email').value, items }; const res = await fetch(API+'/orders',{ method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(body) }); if(res.ok){ alert('Order placed'); localStorage.removeItem('cart'); window.location.href='/shop'; }else{ alert('Failed'); } });
window.onload = ()=> renderCart();